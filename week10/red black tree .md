紅黑樹
（英語：Red–black tree）是一種自平衡二叉查找樹，是在計算機科學中用到的一種數據結構，典型的用途是實現關聯數組。
它是在1972年由魯道夫·貝爾發明的，他稱之為”對稱二叉B樹”，它現代的名字是在Leo J. Guibas和Robert Sedgewick於1978年寫的一篇論文中獲得的。
它是覆雜的，但它的操作有著良好的最壞情況運行時間，並且在實踐中是高效的：它可以在O(log n)時間內做查找，插入和刪除，這裏的n是樹中元素的數目。

紅黑樹相對於AVL樹來說，犧牲了部分平衡性以換取插入/刪除操作時少量的旋轉操作，整體來說性能要優於AVL樹。

性質
紅黑樹是每個節點都帶有顏色屬性的二叉查找樹，顏色為紅色或黑色。在二叉查找樹強制一般要求以外，對於任何有效的紅黑樹我們增加了如下的額外要求：

節點是紅色或黑色。
根是黑色。
所有葉子都是黑色（葉子是NIL節點）。
每個紅色節點必須有兩個黑色的子節點。（從每個葉子到根的所有路徑上不能有兩個連續的紅色節點。）
從任一節點到其每個葉子的所有簡單路徑都包含相同數目的黑色節點。
紅黑樹

紅黑樹的關鍵特性：從根到葉子的最長的可能路徑不多於最短的可能路徑的兩倍長。結果是這個樹大致上是平衡的。
因為操作比如插入、刪除和查找某個值的最壞情況時間都要求與樹的高度成比例，這個在高度上的理論上限允許紅黑樹在最壞情況下都是高效的，
而不同於普通的二叉查找樹。

操作
每一個紅黑樹也是一個特化的二叉查找樹，因此紅黑樹上的只讀操作與普通二叉查找樹上的只讀操作相同。
然而，在紅黑樹上進行插入操作和刪除操作會導致不再匹配紅黑樹的性質。
恢覆紅黑樹的性質需要少量（O(log n)）的顏色變更（實際是非常快速的）和不超過三次樹旋轉（對於插入操作是兩次）。
雖然插入和刪除很覆雜，但操作時間仍可以保持為O(log n)次。

紅黑樹的插入
插入節點的關鍵是:

插入新節點總是紅色節點
如果插入節點的父節點是黑色, 能維持性質
如果插入節點的父節點是紅色, 破壞了性質. 故插入算法就是通過重新著色或旋轉, 來維持性質
對於每一種情形，我們將使用C示例代碼來展示。通過下列函數，可以找到一個節點的叔父和祖父節點：
情形1：新節點N位於樹的根上，沒有父節點
在這種情形下，我們把它重繪為黑色以滿足性質2。因為它在每個路徑上對黑節點數目增加一，性質5匹配。

情形2：新節點的父節點P是黑色，所以性質4沒有失效（新節點是紅色的）
在這種情形下，樹仍是有效的。性質5也未受到威脅，盡管新節點N有兩個黑色葉子子節點；
但由於新節點N是紅色，通過它的每個子節點的路徑就都有同通過它所替換的黑色的葉子的路徑同樣數目的黑色節點，所以依然滿足這個性質。

情形3:父節點P和叔父節點U二者都是紅色
（此時新插入節點N做為P的左子節點或右子節點都屬於情形3，這裏右圖僅顯示N做為P左子的情形）則我們可以將它們兩個重繪為黑色並重繪祖父節點G為紅色（用來保持性質5）。現在我們的新節點N有了一個黑色的父節點P。因為通過父節點P或叔父節點U的任何路徑都必定通過祖父節點G，在這些路徑上的黑節點數目沒有改變。但是，紅色的祖父節點G可能是根節點，這就違反了性質2，也有可能祖父節點G的父節點是紅色的，這就違反了性質4。為了解決這個問題，我們在祖父節點G上遞歸地進行情形1的整個過程。（把G當成是新加入的節點進行各種情形的檢查）

情形4：父節點P是紅色而叔父節點U是黑色或缺少
父節點P是紅色而叔父節點U是黑色或缺少，並且新節點N是其父節點P的右子節點而父節點P又是其父節點的左子節點。
在這種情形下，我們進行一次左旋轉調換新節點和其父節點的角色;接著，我們按情形5處理以前的父節點P以解決仍然失效的性質4。
註意這個改變會導致某些路徑通過它們以前不通過的新節點N（比如圖中1號葉子節點）或不通過節點P（比如圖中3號葉子節點），
但由於這兩個節點都是紅色的，所以性質5仍有效。

情形5：父節點P是紅色而叔父節點U是黑色或缺少
父節點P是紅色而叔父節點U是黑色或缺少，新節點N是其父節點的左子節點，而父節點P又是其父節點G的左子節點。
在這種情形下，我們進行針對祖父節點G的一次右旋轉；在旋轉產生的樹中，以前的父節點P現在是新節點N和以前的祖父節點G的父節點。
我們知道以前的祖父節點G是黑色，否則父節點P就不可能是紅色（如果P和G都是紅色就違反了性質4，所以G必須是黑色）。
我們切換以前的父節點P和祖父節點G的顏色，結果的樹滿足性質4。性質5也仍然保持滿足，
因為通過這三個節點中任何一個的所有路徑以前都通過祖父節點G，現在它們都通過以前的父節點P。
在各自的情形下，這都是三個節點中唯一的黑色節點。

紅黑樹的刪除
刪除節點的關鍵是:

如果刪除的是紅色節點, 不破壞性質
如果刪除的是黑色節點, 那麽這個路徑上就會少一個黑色節點, 破壞了性質. 故刪除算法就是通過重新著色或旋轉, 來維持性質
情形1: N是新的根
在這種情形下，我們就做完了。我們從所有路徑去除了一個黑色節點，而新根是黑色的，所以性質都保持著

情形2： S是紅色
在這種情形下我們在N的父親上做左旋轉，把紅色兄弟轉換成N的祖父，我們接著對調N的父親和祖父的顏色。
完成這兩個操作後，盡管所有路徑上黑色節點的數目沒有改變，但現在N有了一個黑色的兄弟和一個紅色的父親
（它的新兄弟是黑色因為它是紅色S的一個兒子），所以我們可以接下去按情形4、情形5或情形6來處理。

情形3：N的父親、S和S的兒子都是黑色的
在這種情形下，我們簡單的重繪S為紅色。結果是通過S的所有路徑，它們就是以前不通過N的那些路徑，都少了一個黑色節點。
因為刪除N的初始的父親使通過N的所有路徑少了一個黑色節點，這使事情都平衡了起來。
但是，通過P的所有路徑現在比不通過P的路徑少了一個黑色節點，所以仍然違反性質5。要修正這個問題，我們要從情形1開始，在P上做重新平衡處理。

情形4： S和S的兒子都是黑色，但是N的父親是紅色
在這種情形下，我們簡單的交換N的兄弟和父親的顏色。這不影響不通過N的路徑的黑色節點的數目，
但是它在通過N的路徑上對黑色節點數目增加了一，添補了在這些路徑上刪除的黑色節點。

情形5： S是黑色，S的左兒子是紅色，S的右兒子是黑色，而N是它父親的左兒子
在這種情形下我們在S上做右旋轉，這樣S的左兒子成為S的父親和N的新兄弟。我們接著交換S和它的新父親的顏色。
所有路徑仍有同樣數目的黑色節點，但是現在N有了一個黑色兄弟，他的右兒子是紅色的，所以我們進入了情形6。N和它的父親都不受這個變換的影響。

情形6： S是黑色，S的右兒子是紅色，而N是它父親的左兒子
在這種情形下我們在N的父親上做左旋轉，這樣S成為N的父親（P）和S的右兒子的父親。我們接著交換N的父親和S的顏色，並使S的右兒子為黑色。子樹在它的根上的仍是同樣的顏色，所以性質3沒有被違反。但是，N現在增加了一個黑色祖先：要麽N的父親變成黑色，要麽它是黑色而S被增加為一個黑色祖父。所以，通過N的路徑都增加了一個黑色節點。

此時，如果一個路徑不通過N，則有兩種可能性：

它通過N的新兄弟。那麽它以前和現在都必定通過S和N的父親，而它們只是交換了顏色。所以路徑保持了同樣數目的黑色節點。
它通過N的新叔父，S的右兒子。那麽它以前通過S、S的父親和S的右兒子，但是現在只通過S，它被假定為它以前的父親的顏色，
和S的右兒子，它被從紅色改變為黑色。合成效果是這個路徑通過了同樣數目的黑色節點。
在任何情況下，在這些路徑上的黑色節點數目都沒有改變。所以我們恢覆了性質4。在示意圖中的白色節點可以是紅色或黑色，
但是在變換前後都必須指定相同的顏色。







